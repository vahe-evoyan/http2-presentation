<h1>HTTP/2</h1>

<div style="float:left; width: 50%">
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="243px" height="273px" version="1.1"><defs><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-dae8fc-1-7ea6e0-1-s-0"><stop offset="0%" style="stop-color:#DAE8FC"/><stop offset="100%" style="stop-color:#7EA6E0"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffffff-0.9-ffffff-0.1-s-0"><stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.9"/><stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.1"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-d5e8d4-1-97d077-1-s-0"><stop offset="0%" style="stop-color:#D5E8D4"/><stop offset="100%" style="stop-color:#97D077"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-ffcd28-1-ffa500-1-s-0"><stop offset="0%" style="stop-color:#FFCD28"/><stop offset="100%" style="stop-color:#FFA500"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-fff2cc-1-ffd966-1-s-0"><stop offset="0%" style="stop-color:#FFF2CC"/><stop offset="100%" style="stop-color:#FFD966"/></linearGradient><linearGradient x1="0%" y1="0%" x2="0%" y2="100%" id="mx-gradient-dae8fc-1-ffffff-1-s-0"><stop offset="0%" style="stop-color:#DAE8FC"/><stop offset="100%" style="stop-color:#ffffff"/></linearGradient></defs><g transform="translate(0.5,0.5)"><rect x="1" y="1" width="240" height="90" fill="url(#mx-gradient-dae8fc-1-7ea6e0-1-s-0)" stroke="#6c8ebf" pointer-events="none"/><path d="M 0 0 L 0 37 Q 121 64 242 37 L 242 0 Z" fill="url(#mx-gradient-ffffff-0.9-ffffff-0.1-s-0)" stroke="none" pointer-events="none"/><g transform="translate(36,9)"><switch><foreignObject pointer-events="all" width="169" height="21" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 169px; white-space: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Application (HTTP/2)</div></div></foreignObject><text x="85" y="19" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><rect x="1" y="91" width="240" height="60" fill="url(#mx-gradient-d5e8d4-1-97d077-1-s-0)" stroke="#82b366" pointer-events="none"/><path d="M 0 90 L 0 115 Q 121 133 242 115 L 242 90 Z" fill="url(#mx-gradient-ffffff-0.9-ffffff-0.1-s-0)" stroke="none" pointer-events="none"/><g transform="translate(61,112)"><switch><foreignObject pointer-events="all" width="119" height="21" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 119px; white-space: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Session (TLS)</div></div></foreignObject><text x="60" y="19" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><rect x="1" y="151" width="240" height="60" fill="url(#mx-gradient-ffcd28-1-ffa500-1-s-0)" stroke="#d79b00" pointer-events="none"/><path d="M 0 150 L 0 175 Q 121 193 242 175 L 242 150 Z" fill="url(#mx-gradient-ffffff-0.9-ffffff-0.1-s-0)" stroke="none" pointer-events="none"/><g transform="translate(54,172)"><switch><foreignObject pointer-events="all" width="133" height="21" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 133px; white-space: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Transport (TCP)</div></div></foreignObject><text x="67" y="19" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><rect x="1" y="211" width="240" height="60" fill="url(#mx-gradient-fff2cc-1-ffd966-1-s-0)" stroke="#d6b656" pointer-events="none"/><path d="M 0 210 L 0 235 Q 121 253 242 235 L 242 210 Z" fill="url(#mx-gradient-ffffff-0.9-ffffff-0.1-s-0)" stroke="none" pointer-events="none"/><g transform="translate(68,232)"><switch><foreignObject pointer-events="all" width="105" height="21" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 105px; white-space: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Network (IP)</div></div></foreignObject><text x="53" y="19" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica" font-weight="bold">[Not supported by viewer]</text></switch></g><rect x="26" y="41" width="190" height="50" fill="url(#mx-gradient-dae8fc-1-ffffff-1-s-0)" stroke="#6c8ebf" pointer-events="none"/><g transform="translate(60,57)"><switch><foreignObject pointer-events="all" width="121" height="21" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 121px; white-space: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Binary Framing</div></div></foreignObject><text x="61" y="19" fill="#000000" text-anchor="middle" font-size="16px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>
</div>

<div style="float:left; width: 50%">
  <h3>Binary protocol</h3>
  <h3>TLS is optional</h3>
  <h3>Application-Layer Protocol Negotiation</h3>
</div>

<aside class="notes">

Finally, we get into the main topic for today. HTTP/2, as said earlier,
inherits the most of it's features from SPDY and binary protocol is one of
them. TLS protocol is optional here, though Firefox and Google are not going to
support HTTP/2 without TLS.

<br />

Next Protocol Negotiation is renamed to ALPN, which is independent from TLS and
works for the non-encrypted connection as well.

</aside>

<!-- page -->

# Multiplexing

<!-- .slide: data-background="slides/images/wires.jpg" -->

### Stream - Message - Frame

![Frames](slides/images/frames.png)

Note:

So what binary framing actually allows? Multiplexing is the most major part of
the protocol. Now the client is connected to the origin with a single
connection.

  - All communication is performed over a single TCP connection that can carry
    any number of bidirectional streams.
  - Each stream has a unique identifier and optional priority information that
    is used to carry bidirectional messages.
  - Each message is a logical HTTP message, such as a request, or response,
    which consists of one or more frames.
  - The frame is the smallest unit of communication that carries a specific
    type of data â€” e.g., HTTP headers, message payload, and so on. Frames from
    different streams may be interleaved and then reassembled via the embedded
    stream identifier in the header of each frame.

<!-- page -->

# Prioritization

<!-- .slide: data-background="slides/images/priority.jpg" -->

### Weighted streams
### Dependencies

Note:

Streams are prioritized using weights. Each stream has a weight, a number from
1..256 which defines it's priority. These streams also have references to each
other building a tree of dependencies.

<!-- page -->

# Server Push

<!-- .slide: data-background="slides/images/dont-push.jpg" -->

### PUSH_PROMISE Frames
### RST_STREAM Frames

Note:

Let's fall back a bit a remember how the browser requests for the resources.
First thing is to get the main HTML page, which then is parsed for the rest of
resources like images, style-sheets, scripts etc. These are requested only
after the main HTML page is loaded and parsed by the browser.

Now, imagine that the server is smart enough to send you all these resources
beforehand. Isn't it amazing? The way it works is server itself parses the
content it sends and sends *PROMISE* frames to the client, for each resource it
thinks would be used by the client. The client can accept or reject by
responding with the *RESET* frame.

Note that this is impossible to implement with the HTTP 1.1. To reset the
incoming connection, yet another three way handshake is required for TCP
protocol (FIN - FIN:ACK - ACK).


<!-- page -->

# Header Compression

<!-- .slide: data-background="slides/images/zip.jpg" -->

### HPACK

Note:

Another great feature for the HTTP/2, which again is not possible with HTTP 1.1
is the header compression called HPACK. This becomes possible because of the
binary protocol.

In HTTP 1.1 the compression is not possible because of the headers being in
different contexts. Each request has approximately 500-800 bytes of overhead.

To reduce this overhead and improve performance, HTTP/2 compresses request and
response header meta-data using the HPACK compression format that uses two
simple but powerful techniques:

  - It allows the transmitted header fields to be encoded via a static Huffman
    code, which reduces their individual transfer size.
  - It requires that both the client and server maintain and update an indexed
    list of previously seen header fields (i.e., establishes a shared
    compression context), which is then used as a reference to efficiently
    encode previously transmitted values.

<!-- page -->

# AND A LOT MORE

 - [Security Now (Ep. 495). HTTP/2](https://www.grc.com/sn/sn-495.htm)
 - [HTTP vs HTTPS - Test them both](http://httpvshttps.com)
 - [HTTP/2 Specs (RFC 2119)](https://http2.github.io)
 - [http2 explained - The HTTP/2 book](http://daniel.haxx.se/http2/)
